<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enable GD Extension - ESP32 Lock System</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: #1a1f26;
        color: #e0e0e0;
      }
      h1 {
        color: #4a9eff;
      }
      h2 {
        color: #6ab7ff;
        margin-top: 30px;
      }
      .step {
        background: #252b36;
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        border-left: 4px solid #4a9eff;
      }
      code {
        background: #1a1f26;
        padding: 2px 6px;
        border-radius: 4px;
        color: #ffa500;
      }
      .success {
        color: #4ade80;
      }
      .error {
        color: #f87171;
      }
      .warning {
        color: #fbbf24;
      }
      .btn {
        background: #2563eb;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        margin: 10px 5px;
      }
      .btn:hover {
        opacity: 0.9;
      }
      #status {
        margin: 20px 0;
        padding: 15px;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <h1>üîß H∆∞·ªõng d·∫´n b·∫≠t GD Extension</h1>

    <div id="status" style="background: #252b36">
      <p>ƒêang ki·ªÉm tra tr·∫°ng th√°i GD Extension...</p>
    </div>

    <h2>üìã C√°ch b·∫≠t GD Extension trong XAMPP</h2>

    <div class="step">
      <strong>B∆∞·ªõc 1:</strong> M·ªü <strong>XAMPP Control Panel</strong>
    </div>

    <div class="step">
      <strong>B∆∞·ªõc 2:</strong> Nh·∫•n n√∫t <strong>Config</strong> b√™n c·∫°nh Apache
    </div>

    <div class="step">
      <strong>B∆∞·ªõc 3:</strong> Ch·ªçn <strong>PHP (php.ini)</strong>
    </div>

    <div class="step">
      <strong>B∆∞·ªõc 4:</strong> T√¨m d√≤ng c√≥ <code>;extension=gd</code> (c√≥ d·∫•u
      <code>;</code> ·ªü ƒë·∫ßu)
    </div>

    <div class="step">
      <strong>B∆∞·ªõc 5:</strong> X√≥a d·∫•u <code>;</code> ƒë·ªÉ th√†nh:
      <code>extension=gd</code>
    </div>

    <div class="step"><strong>B∆∞·ªõc 6:</strong> L∆∞u file v√† ƒë√≥ng l·∫°i</div>

    <div class="step">
      <strong>B∆∞·ªõc 7:</strong> Trong XAMPP Control Panel, nh·∫•n
      <strong>Stop</strong> r·ªìi <strong>Start</strong> l·∫°i Apache
    </div>

    <div class="step">
      <strong>B∆∞·ªõc 8:</strong> Reload trang n√†y ƒë·ªÉ ki·ªÉm tra
    </div>

    <h2>üîÑ Ho·∫∑c s·ª≠a th·ªß c√¥ng</h2>
    <div class="step">
      <p>M·ªü file: <code>C:\xampp\php\php.ini</code></p>
      <p>T√¨m v√† s·ª≠a: <code>;extension=gd</code> ‚Üí <code>extension=gd</code></p>
      <p>L∆∞u file v√† restart Apache</p>
    </div>

    <h2>‚ö†Ô∏è Gi·∫£i ph√°p t·∫°m th·ªùi</h2>
    <div class="step">
      <p>
        N·∫øu kh√¥ng th·ªÉ b·∫≠t GD, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông chuy·ªÉn sang ch·∫ø ƒë·ªô
        <strong>Simple Mode</strong> (ch·ª•p ·∫£nh ƒë·ªãnh k·ª≥ m√† kh√¥ng ph√°t hi·ªán chuy·ªÉn
        ƒë·ªông).
      </p>
    </div>

    <div style="margin-top: 30px">
      <a href="index.php" class="btn">‚Üê Quay l·∫°i trang ch√≠nh</a>
      <button onclick="location.reload()" class="btn">üîÑ Ki·ªÉm tra l·∫°i</button>
      <a href="api/esp32/test_auto.php" class="btn">üß™ Test chi ti·∫øt</a>
    </div>

    <script>
      async function checkGD() {
        try {
          const res = await fetch("/Project_Q/public/api/check_gd.php");
          const data = await res.json();

          const statusDiv = document.getElementById("status");

          if (data.gd_available) {
            statusDiv.innerHTML = `
                        <h3 class="success">‚úÖ GD Extension ƒë√£ ƒë∆∞·ª£c b·∫≠t!</h3>
                        <p>B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë·∫ßy ƒë·ªß t√≠nh nƒÉng ph√°t hi·ªán chuy·ªÉn ƒë·ªông.</p>
                        <pre>${JSON.stringify(data.gd_info, null, 2)}</pre>
                    `;
            statusDiv.style.background = "#064e3b";
          } else {
            statusDiv.innerHTML = `
                        <h3 class="error">‚ùå GD Extension ch∆∞a ƒë∆∞·ª£c b·∫≠t</h3>
                        <p class="warning">H√£y l√†m theo h∆∞·ªõng d·∫´n b√™n d∆∞·ªõi ƒë·ªÉ b·∫≠t GD extension.</p>
                        <p>Ho·∫∑c h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông s·ª≠ d·ª•ng ch·∫ø ƒë·ªô Simple Mode.</p>
                    `;
            statusDiv.style.background = "#7f1d1d";
          }
        } catch (e) {
          document.getElementById("status").innerHTML = `
                    <h3 class="error">‚ùå L·ªói ki·ªÉm tra</h3>
                    <p>${e.message}</p>
                `;
        }
      }

      checkGD();
    </script>
  </body>
</html>
